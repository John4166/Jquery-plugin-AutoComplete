(function($){function AutoComplete(selector,data,isAllow,id){this.eleInput=$(selector);this.data=data;this.id=id;this.selectedEleId="";this.allowInput=isAllow;this.draw=function(){var that=this;var dataArr=that.data;var flag=false;var eleUL=$('<ul class="auto-datalist" id="'+that.id+'"></ul>');eleUL.width(this.eleInput.outerWidth());function getDisplayData(array,str){var displayData=[],j=0;for(var i=0;i<array.length;i++){if(array[i].name.indexOf(str)>=0){displayData[j]=array[i];j++}}return displayData}function ShowArray(array){eleUL.empty();if(typeof array=="object"&&array.constructor==Array){$.each(array,function(index,value){var eleDataList=document.createElement("li");eleDataList.className="auto-list";eleDataList.innerText=value.name;eleDataList.setAttribute("data-value",value.id);eleDataList.addEventListener("mousedown",function(event){var e=event||window.event;that.eleInput.val(e.target.innerHTML);that.selectedEleId=e.target.getAttribute("data-value")});eleUL.append(eleDataList).show()})}}that.eleInput.on("input",function(){flag=false;var val=$.trim(that.eleInput.val()),displayData;if(val!=""){displayData=getDisplayData(dataArr,val);if(displayData.length==0){flag=true}}else{displayData=dataArr}ShowArray(displayData)}).wrap("<div style='display:inline-block;position:relative;'></div>").focus(function(){$(this).after(eleUL);ShowArray(dataArr)}).blur(function(){if(that.allowInput&&flag){$(this).val("")}eleUL.hide()}).keydown(function(e){var elemUL=$("#"+that.id);var viewHeight=elemUL.outerHeight();var eleLiHeight=elemUL.find("li:gt(0)").outerHeight();var $elem=elemUL.find("li.auto-list-active");if(e.keyCode==40){if($elem.length!=0){var $next=$elem.next();$elem.removeClass("auto-list-active");$next.addClass("auto-list-active");var nextIndex=$("#"+that.id+" li").index($next);var nextTotalHeight=parseInt(nextIndex+1)*parseInt(eleLiHeight);if(nextTotalHeight>=viewHeight){elemUL.scrollTop(nextTotalHeight-eleLiHeight)}}else{elemUL.find("li:first-child").addClass("auto-list-active")}}if(e.keyCode==38){if($elem.length!=0){var $prev=$elem.prev();$elem.removeClass("auto-list-active");$prev.addClass("auto-list-active");var prevIndex=$("#"+that.id+" li").index($prev);var prevTotalHeight=parseInt(prevIndex+1)*parseInt(eleLiHeight);elemUL.scrollTop(prevTotalHeight-eleLiHeight)}else{return false}}if(e.keyCode==13){if($elem.length!=0){$(this).val($elem.text());that.selectedEleId=$elem.attr("data-value");eleUL.hide()}}})}}$.fn.autoComplete=function(obj){var selector=$(this);var isAllow=obj.isAllow||false;var ulId=obj.id;var autoInstance=new AutoComplete(selector,obj.data,isAllow,ulId);autoInstance.draw();return autoInstance}})(jQuery);